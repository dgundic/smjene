<!doctype html>
<html lang="hr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Primjer kalendara - smjene</title>
  <!-- Pretpostavka: koristite style.css iz repozitorija (ili modificiranu verziju s varijablama za boje) -->
  <link rel="stylesheet" href="./style.css">
  <style>
    /* mali stil za centriranje demo stranice */
    body { padding: 18px; }
    .controls { display:flex; gap:10px; align-items:center; margin-bottom:10px; flex-wrap:wrap; }
    .status { margin-top:8px; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Raspored smjena — demo</h1>
    </header>

    <div class="card">
      <div class="controls">
        <label for="apiUrl">API URL:</label>
        <input id="apiUrl" type="url" value="/api/shifts" style="min-width:220px;" placeholder="https://example.com/api/shifts" />

        <label for="month">Mjesec:</label>
        <input id="month" type="month" value="">

        <button id="render">Učitaj i prikaži</button>
      </div>

      <div id="status" class="status" aria-live="polite"></div>

      <div class="legend" aria-hidden="false">
        <div class="legend__item"><span class="legend__swatch" style="background:var(--shift-day)"></span> Dnevna</div>
        <div class="legend__item"><span class="legend__swatch" style="background:var(--shift-night)"></span> Noćna</div>
        <div class="legend__item"><span class="legend__swatch" style="background:var(--shift-evening)"></span> Poslijepodne</div>
        <div class="legend__item"><span class="legend__swatch" style="background:var(--shift-remote)"></span> Remote</div>
        <div class="legend__item"><span class="legend__swatch" style="background:var(--shift-off)"></span> Slobodan</div>
      </div>

      <div class="calendar" id="calendar"></div>
    </div>
  </div>

  <script src="./shifts.js"></script>
  <script>
    // fallback sample podaci (koriste se samo ako fetch ne uspije)
    const fallbackShifts = [
      { date: "2025-11-01", shifts: ["day"] },
      { date: "2025-11-02", shifts: ["night"] },
      { date: "2025-11-03", shifts: ["evening"] },
      { date: "2025-11-04", shifts: ["off"] },
      { date: "2025-11-05", shifts: ["day","night"] },
      { date: "2025-11-06", shifts: ["remote"] }
    ];

    const apiInput = document.getElementById('apiUrl');
    const monthInput = document.getElementById('month');
    const statusEl = document.getElementById('status');
    const renderBtn = document.getElementById('render');

    // inicijalno postavi input na trenutni mjesec
    const now = new Date();
    monthInput.value = now.toISOString().slice(0,7);

    async function fetchShifts(apiUrl) {
      try {
        statusEl.textContent = 'Učitavanje podataka...';
        const res = await fetch(apiUrl, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        // očekujemo array objekata {date: 'YYYY-MM-DD', shifts: [...]}
        if (!Array.isArray(data)) throw new Error('Neispravan format podataka');
        statusEl.textContent = '';
        return data;
      } catch (err) {
        console.warn('Fetch shifts failed', err);
        statusEl.textContent = 'Neuspjelo učitavanje podataka, koristi se lokalni primjer.';
        return fallbackShifts;
      }
    }

    renderBtn.addEventListener('click', async () => {
      const apiUrl = apiInput.value || '/api/shifts';
      const [y, m] = monthInput.value.split('-').map(Number);
      if (!y || !m) {
        statusEl.textContent = 'Odaberi valjan mjesec.';
        return;
      }

      const shifts = await fetchShifts(apiUrl);
      createMonthCalendar(document.getElementById('calendar'), y, m, shifts);
      statusEl.textContent = '';
    });

    // učitaj i prikaži odmah pri otvaranju (pokuša pozvati API, pa fallback ako treba)
    (async function init() {
      const apiUrl = apiInput.value || '/api/shifts';
      const [y0, m0] = monthInput.value.split('-').map(Number);
      const shifts = await fetchShifts(apiUrl);
      createMonthCalendar(document.getElementById('calendar'), y0, m0, shifts);
    })();
  </script>
</body>
</html>